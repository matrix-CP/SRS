@model IEnumerable<SRS.Models.tblStudent>
@{
    ViewBag.Title = "Index";
}


<div>
    <h2>Books</h2>
    <table id="studentTable" class="table table-striped">
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Dob</th>
                <th>Gender</th>
                <th>Address</th>
                <th>Languages</th>
                <th>Courses</th>
                <th>Profile</th>
                <th>Document</th>
                <th>Mobile Number</th>
            </tr>
        </thead>
        <tbody>
            <!-- The table data will be filled using AJAX -->
        </tbody>
    </table>
</div>

<div>
    <h2>Add Student</h2>
    <form id="addStudentForm">

        <div class="form-group">
            <label for="c_name">Name</label>
            <input class="form-control" type="text" id="c_name" required/>
        </div>
        <div class="form-group">
            <label for="c_birthdate">Dob</label>
            <input class="form-control" type="date" id="c_birthdate" required/>
        </div>
        <div class="form-group">
            <label for="c_gender">Gender</label>
            <input type="radio" name="c_gender" value="Male" /> Male
            <input type="radio" name="c_gender" value="Female" /> Female
            <input type="radio" name="c_gender" value="Other" /> Other
        </div>
        <div class="form-group">
            <label for="c_address">Address</label>
            <input class="form-control" type="text" id="c_address" required/>
        </div>
        <div class="form-group">
            <label for="c_language">Languages</label>
            <input name="c_language" id="Hindi" type="checkbox" value="Hindi"><label for="Hindi">Hindi</label>
            <input name="c_language" id="English" type="checkbox" value="English"><label for="English">English</label>
            <input name="c_language" id="Gujarati" type="checkbox" value="Gujarati"><label for="Gujarati">Gujarati</label>

        </div>
        <div class="form-group">
            <label for="c_course">Courses</label>
            <select class="form-control" id="c_course" name="c_course" required>
                <option value="">Select Course Name</option>
                <option Value="1">AI-ML</option>
                <option Value="2">CyberSecurity</option>
                <option Value="3">DataScience</option>
            </select>
        </div>
        <div class="form-group">
            <label for="">Profile</label>
            <input class="form-control" type="file" id="c_profile" required/>
        </div>
        <div class="form-group">
            <label for="">Document</label>
            <input class="form-control" type="file" id="c_document" required/>
        </div>
        <div class="form-group">
            <label for="">Mobile Number</label>
            <input class="form-control" type="number" id="c_mobile" required/>
        </div>
        <button type="button" class="btn btn-primary" id="addStudentButton" onclick="Adddata()">Add Student</button>
        <input type="button" onclick="ResetStudent()" value="Reset Student.." class="btn btn-danger" />


        @* <div class="form-group">
        <label for="booktitle">Title:</label>
        <input type="text" class="form-control" id="booktitle" name="booktitle">
        </div>
        <div class="form-group">
        <label for="author">Author:</label>
        <input type="text" class="form-control" id="author" name="author">
        </div>
        <div class="form-group">
        <label for="price">Price:</label>
        <input type="text" class="form-control" id="price" name="price">
        </div>
        <div class="form-group">
        <label for="pages">Pages:</label>
        <input type="text" class="form-control" id="pages" name="pages">
        </div>
        <br />
        <button type="button" class="btn btn-primary" id="addBookButton" onclick="Adddata()">Add Book</button>
        <input type="button" onclick="ResetBook()" value="Reset Book.." class="btn btn-danger" /> *@
    </form>
</div>
<br />

<!-- Edit Book Modal -->
<div class="modal fade" id="editBookModal" tabindex="-1" role="dialog" aria-labelledby="editBookModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBookModalLabel">Edit Book</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editBookForm">
                    <input type="hidden" id="c_studentid" name="c_studentid">
                    <div class="form-group">
                        <label for="c_nameEdit">Name</label>
                        <input class="form-control" type="text" id="c_nameEdit" />
                    </div>
                    <div class="form-group">
                        <label for="c_birthdateEdit">Dob</label>
                        <input class="form-control" type="date" id="c_birthdateEdit" />
                    </div>
                    <div class="form-group">
                        <label for="">Gender</label>
                        <input type="radio" name="c_genderEdit" value="Male" /> Male
                        <input type="radio" name="c_genderEdit" value="Female" /> Female
                        <input type="radio" name="c_genderEdit" value="Other" /> Other
                    </div>
                    <div class="form-group">
                        <label for="c_addressEdit">Address</label>
                        <input class="form-control" type="text" id="c_addressEdit" />
                    </div>
                    <div class="form-group">
                        <label for="c_languageEdit">Languages</label>
                        <input name="c_languageEdit" type="checkbox" id="HindiEdit" value="Hindi"><label for="Hindi">Hindi</label>
                        <input name="c_languageEdit" type="checkbox" id="EnglishEdit" value="English"><label for="English">English</label>
                        <input name="c_languageEdit" type="checkbox" id="GujaratiEdit" value="Gujarati"><label for="Gujarati">Gujarati</label>

                    </div>
                    <div class="form-group">
                        <label for="c_courseEdit">Courses</label>
                        <select class="form-control" id="c_courseEdit" name="c_courseEdit">
                            <option Value="1">AI-ML</option>
                            <option Value="2">CyberSecurity</option>
                            <option Value="3">DataScience</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="c_profileEdit">Profile</label>
                        <input class="form-control" type="file" id="c_profileEdit" />
                    </div>
                    <div class="form-group">
                        <label for="c_documentEdit">Document</label>
                        <input class="form-control" type="file" id="c_documentEdit" />
                    </div>
                    <div class="form-group">
                        <label for="c_mobileEdit">Mobile Number</label>
                        <input class="form-control" type="number" id="c_mobileEdit" />
                    </div>

                    @* <div class="form-group">
                    <label for="editBookTitle">Title:</label>
                    <input type="text" class="form-control" id="editBookTitle" name="editBookTitle">
                    </div>
                    <div class="form-group">
                    <label for="editBookAuthor">Author:</label>
                    <input type="text" class="form-control" id="editBookAuthor" name="editBookAuthor">
                    </div>
                    <div class="form-group">
                    <label for="editBookPrice">Price:</label>
                    <input type="text" class="form-control" id="editBookPrice" name="editBookPrice">
                    </div>
                    <div class="form-group">
                    <label for="editBookPages">Pages:</label>
                    <input type="text" class="form-control" id="editBookPages" name="editBookPages">
                    </div> *@
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                    id="closeModalButton">Close</button>


                @* <button type="button" class="btn btn-secondary" id="closeModalButton">Close</button> *@
                <Buttton class="btn btn-success" id="editStudent" type="button">Update Student</Buttton>
            </div>
        </div>
    </div>

</div>
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

@section Scripts {
    <script>
       

        function ResetStudent() {
            $('#addStudentForm')[0].reset();
        }
        



        function loadStudent2() {
            $.ajax({
                url: '/Student/GetAllStudents',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    var studentTable = $('#studentTable tbody');
                    studentTable.empty();
                    data.forEach(function (student) {
                        var row = '<tr>';
                        row += '<td>' + student.c_studentid + '</td>';
                        row += '<td>' + student.c_name + '</td>';
                        row += '<td>' + student.c_birthdate + '</td>';
                        row += '<td>' + student.c_gender + '</td>';
                        row += '<td>' + student.c_address + '</td>';
                        row += '<td>' + student.c_language + '</td>';
                        row += '<td>' + student.c_coursename + '</td>';
                        row += '<td>' + student.c_profile + '</td>';
                        row += '<td>' + student.c_document + '</td>';
                        row += '<td>' + student.c_mobile + '</td>';
                        row += '<td><button class="btn btn-primary edit" data-id="' + student.c_studentid + '">Edit</button>';
                        row += '<button class="btn btn-danger delete" data-id="' + student.c_studentid + '">Delete</button></td>';
                        row += '</tr>';
                        studentTable.append(row);

                    });
                }
            });
        }

        function Adddata() {
            var allFieldsFilled = true;
                $('#addStudentForm input[required]').each(function () {
                    debugger
                    if ($(this).val() == '') {
                        allFieldsFilled=false;
                    }
                });
                if(!allFieldsFilled)
                {
                    debugger
                    alert("Fill All The Fields!");
                    return;
                }
            var values = $('input[name="c_language"]:checked').map(function() {
                return $(this).val();
            }).get();
            if(values.length==0){
                alert("Please Select Language");
                return;
            }
            if($('#c_course').val()==""){
                alert("Please Select Course!");
                return;
            }
            if(!$("#Hindi").prop("checked") && !$("#English").prop("checked") && !$("#Gujarati").prop("checked")){
                alert("Please Select Gender");
                return;
            }
            var language = new Array();
            if ($("#Hindi").prop("checked"))
                language.push("Hindi")
            if ($("#Gujarati").prop("checked"))
                language.push("Gujarati")
            if ($("#English").prop("checked"))
                language.push("English")
            var gender = $('input[name="c_gender"]:checked').val();
            var name = $('#c_name').val();
            var dob = $('#c_birthdate').val();
            var address = $('#c_address').val();
            var course = $('#c_course').val();

            var profile = $('#c_profile').val();
            var doc = $('#c_document').val();
            var mobile = $('#c_mobile').val();



            var newBook = {
                c_name: name,
                c_birthdate: dob,
                c_gender: gender,
                c_address: address,
                c_language:language,
                c_course: course,
                c_profile: profile,
                c_document: doc,
                c_mobile: mobile,


            };


            $.ajax({
                url: './AjaxAdd',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(newBook),
                success: function (data) {

                    if (data) {
                        if(data.status){
                            alert(data.message);
                        }
                        else{
                            alert("Some error Occured!");
                        }
                        @* ResetBook(); *@
                        

                        loadStudent2();
                        ResetStudent();
                    } else {
                        console.log('Error adding book');
                    }
                },
                error: function (error) {
                    console.log('AJAX error:', error);
                }
            });
        }

        $(document).ready(function () {

            loadStudents();


            $('#studentTable').on('click', '.delete', deleteStudent);
            function deleteStudent() {
                var studentId = $(this).data('id');

                var result = confirm("Are you sure for delete !");
                if (result) {
                    $.ajax({
                        url: './AjaxDelete',
                        type: 'POST',
                        data: { id: studentId },
                        dataType: 'json',
                        success: function (data) {
                            if(data.status){
                                alert(data.message);
                            }
                            else{
                                alert("Some Error While Deleting!");
                            }
                            loadStudent2();
                        },
                    });
                }
            }


            $('#studentTable').on('click', '.edit', editStudent);

            function editStudent() {
                var studentId = $(this).data('id');
                $('#c_studentid').val(studentId);
                $.ajax({
                    url: './AjaxDetails',
                    type: 'GET',
                    data: { id: studentId },
                    dataType: 'json',
                    success: function (data) {
                        $('#c_studentid').val(data.c_studentid);
                        $('#c_nameEdit').val(data.c_name);
                        $("#c_birthdateEdit").val(data.c_birthdate.split('T')[0]);
                        $("input[name='c_genderEdit'][value='" + data.c_gender + "']").prop("checked", true);
                        $.each(data.c_language, function(index, value) {
                            $("input[name='c_languageEdit'][value='" + value + "']").prop("checked", true);
                        }),
                        $('#c_addressEdit').val(data.c_address);
                        $('#c_courseEdit').val(data.c_course);
                        @* $('#c_profileEdit').val(data.c_profile); *@
                        @* $('#c_documentEdit').val(data.c_document); *@
                        $('#c_mobileEdit').val(data.c_mobile);

        @* $('#editBookId').val(data.myid1);
                        $('#editBookTitle').val(data.booktitle);
                        $('#editBookAuthor').val(data.author);
                        $('#editBookPrice').val(data.price);
                        $('#editBookPages').val(data.pages); *@
                    },
                });
                $('#editBookModal').modal('show');
            }


            $('#editStudent').on('click', updateStudent);
            function updateStudent() {
                var language = new Array();
                if ($("#HindiEdit").prop("checked"))
                    language.push("Hindi")
                if ($("#GujaratiEdit").prop("checked"))
                    language.push("Gujarati")
                if ($("#EnglishEdit").prop("checked"))
                    language.push("English")
                var gender = $('input[name="c_genderEdit"]:checked').val();
                var student = {
                    c_studentid: $('#c_studentid').val(),
                    c_name: $('#c_nameEdit').val(),
                    c_birthdate: $('#c_birthdateEdit').val(),
                    c_gender: gender,
                    c_language:language,
                    c_address: $('#c_addressEdit').val(),
                    c_course: $('#c_courseEdit').val(),
                    c_profile: $('#c_profileEdit').val(),
                    c_document: $('#c_documentEdit').val(),
                    c_mobile: $('#c_mobileEdit').val(),

        @* $('#editBookId').val(data.myid1);
                $('#editBookTitle').val(data.booktitle);
                $('#editBookAuthor').val(data.author);
                $('#editBookPrice').val(data.price);
                $('#editBookPages').val(data.pages); *@
                    };

            $.ajax({
                url: './AjaxEdit',
                type: 'POST',
                data: JSON.stringify(student),
                contentType: 'application/json; charset-utf-8',
                success: function (result) {
                    if(result.status){
                        $('#editBookModal').modal('hide');
                        alert(result.message);
                    }
                    else{
                        alert("Some error Occured!");
                    }
                    loadStudent2();
                },
            });
        }

                function loadStudents() {
                $.ajax({
                    url: '/Student/GetAllStudents',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        var studentTable = $('#studentTable tbody');
                        studentTable.empty();
                        data.forEach(function (student) {
                            var row = '<tr>';
                            row += '<td>' + student.c_studentid + '</td>';
                            row += '<td>' + student.c_name + '</td>';
                            row += '<td>' + student.c_birthdate + '</td>';
                            row += '<td>' + student.c_gender + '</td>';
                            row += '<td>' + student.c_address + '</td>';
                            row += '<td>' + student.c_language + '</td>';
                            row += '<td>' + student.c_coursename + '</td>';
                            row += '<td>' + student.c_profile + '</td>';
                            row += '<td>' + student.c_document + '</td>';
                            row += '<td>' + student.c_mobile + '</td>';
                            row += '<td><button class="btn btn-primary edit" data-id="' + student.c_studentid + '">Edit</button>';
                            row += '<button class="btn btn-danger delete" data-id="' + student.c_studentid + '">Delete</button></td>';
                            row += '</tr>';
                            studentTable.append(row);


                        });
                    }
                });
            }
        });


    </script>
}